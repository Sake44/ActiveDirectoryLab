# Active Directory Lab

Configuration vmware workstation:

For domain controller virtual machine set:

1. at leat 50gb of memory
2. 4-8gb RAM

From vmware workstation toolbar click Edit/Virtual Network Editor

Usually vmnet1 is set as host-only type. (Disable DHCP if you set static IP)

Use subnet class c for local network (**192.168.x.x**)

For Domain Controller set ip address to: **192.168.100.10** path: Control Panel/Network and Internet/ Network and sharing center/ <choose your ethernet>. 
Then go to properties to see the below result:

![Windows Ip settings](/images/ipsettingsDC.png)

Now, create another virtual machine using as network adapter settings:  **Custom (vmnet1)**

![Vmware client network settings](/images/clientVmwareSettings.png)

Log in in our client and set a static ip address: 192.168.100.11

Subnet mask 255.255.255.0 and as preferred DNS 192.168.100.10 **(DC IP)**

Probably, there's a disabled inbound rule in Windows Defender Firewall that does not allow communication in local network. 

Go to: 

1. Windows Defender Firewall
2. Advanced settings
3. Inbound Rule
4. Look for File and Printer Sharing (Echo Request - ICMPv4-In)

![Firewall Inbound rule](/images/FirewallInboundRule.png)

## Install AD DS

It's time to install Active directory through Server Manager:

1. Add roles and features wizard (Your machine will be detected by default)
2. As server roles select: Active directory Domain Services

![Wizard Active Directory](/images/installAD.png)

3. As additional Features leave everything as default.

After installation will have one more section in Server Manager (**AD DS**)

We have to promote our server to be Domain Controller

![Promote to DC](/images/promoteToDC.png)

1. Since this our first DC we have to create a new forest. Choose a root domain name. 

![Domain name, new forest](/images/domainName.png)

2. In Domain controller options choose the preferred forest and domain functional level and leave DNS server and Global catalog selected. Choose a pwd for DSRM.
3. Don't worry about DNS Options
4. Netbios will be generated by default
5. Leave paths as default
6. In prerequisites check be sure password for Administrator is set. If not run:

`lusrmgr.msc`

Find Administrator user and set a strong pwd. Then rerun check prerequisites.

When machine is restarted your server should be Domain Controller. 

### Add client to domain

1. Log in your client machine. 
2. Control Panel / System & Security / System / 
3. Under Computer name, domain... / change settings

![Join client to a domain](/images/joinADomain.png)

4. You need to provide Administrator credential to join domain (need to deep dive on this)
5. Restart your machine to apply settings

When I switched to Domain Controller, I had this warning: 

![COM+ Issue](/images/COM+Issue.png)

To fix I opened WIndows Defender Firewall with Advanced Security throug Server Manager. We have to enable the inbound rule above.
This particolar rule allow DCOM communication received from another machine on the same network.

### Manage User and Groups

In AD Users and Computers you can create Users, Groups and OU and other stuff. I already created some OUs:

1. Windows Server
2. Linux Machine
3. IT

In IT OU I created a group IT-Admin and a user that belongs to IT-Admin Groups. 

### Create a starter GPOs

From Server Manager, I opened Group Policy Management Tool and create there a Starter GPOs:

![Create a starter GPO](/images/createStarterGPOs.png)

I set some rule that can be easily tested. From this starter GPO, I'll create a GPO to link to another computer enrolled in AD DS.
